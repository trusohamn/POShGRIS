(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{174:function(e,t,a){e.exports=a(360)},179:function(e,t,a){},360:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(40),l=a.n(c),o=a(10),i=a(24),u=(a(179),a(7)),s="https://postgris-server.herokuapp.com/",m=r.a.createContext({}),d=function(e,t){fetch(s+e,{method:"GET",credentials:"include"}).then(function(e){return e.json()}).then(function(e){return t(null,e)}).catch(function(e){return console.log(e)})};var p=function(e){var t=Object(n.useState)(null),a=Object(u.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(null),i=Object(u.a)(o,2),s=i[0],p=i[1],f=Object(n.useState)([]),b=Object(u.a)(f,2),E=b[0],h=b[1],v=Object(n.useState)([]),y=Object(u.a)(v,2),g=y[0],k=y[1],N=Object(n.useState)(1),O=Object(u.a)(N,2),j=O[0],_=O[1],T=Object(n.useState)(null),x=Object(u.a)(T,2),C=x[0],S=x[1],P=Object(n.useState)({}),w=Object(u.a)(P,2),I=w[0],L=w[1],R={getProducts:function(){d("/api/products",function(e,t){return l(t)})},products:c,getTickets:function(){d("/api/tickets",function(e,t){return p(t)})},tickets:s,productsInTicket:E,setProductInTicket:h,tablesCoords:g,setTablesCoords:k,nextTicketName:j,incrementNextTicketName:function(){_(j+1)},restaurantName:C,setRestaurantName:S,getRestaurantName:function(){d("/api/restaurants",function(e,t){return S(t.results)})},activeTable:I,setActiveTable:L};return r.a.createElement(m.Provider,{value:R},e.children)};var f=function(e){var t=Object(n.useContext)(m);return Object(n.useEffect)(function(){t.getProducts()},[]),r.a.createElement("div",{className:"productlist-container"},t.products?t.products.results.map(function(t){return e.isOrderView?r.a.createElement("div",{className:"product-card"},r.a.createElement("div",{className:t.product_id,onClick:e.addProductOnClick}," ",r.a.createElement("h3",{className:t.product_id},t.product_name)," ",r.a.createElement("p",{className:t.product_id},"$ ",t.product_price))):r.a.createElement("div",{className:"product-card"},r.a.createElement("div",null,r.a.createElement("h3",null,t.product_name),r.a.createElement("p",null," $ ",t.product_price)))}):null)};var b=function(e){return r.a.createElement("form",{id:"login-form",onSubmit:function(t){t.preventDefault();var a=new URLSearchParams,n=!0,r=!1,c=void 0;try{for(var l,o=new FormData(t.target)[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var i=l.value;console.log(i),a.append(i[0],i[1])}}catch(u){r=!0,c=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw c}}fetch(s+e.apiPath,{method:"POST",credentials:"include",body:a}).then(function(e){return e.json()}).then(function(t){e.afterPost&&e.afterPost(t),document.querySelectorAll("input").forEach(function(e){e.value=""})})}},r.a.createElement("div",{className:"form-holder"},r.a.createElement("div",{className:"login-form"},e.inputs.map(function(e){return"select"===e.type?r.a.createElement("select",{name:e.name},e.options.map(function(e){return r.a.createElement("option",{value:e},e)})):r.a.createElement("input",{type:e.type,name:e.name,placeholder:e.placeholder})})),r.a.createElement("input",{type:"submit",className:"submitButton"})))};var E=function(){var e=Object(n.useContext)(m);return Object(n.useEffect)(function(){e.getProducts()},[]),r.a.createElement("div",null,r.a.createElement(f,{isOrderView:!1}),r.a.createElement(b,{apiPath:"/api/products",inputs:[{type:"text",name:"product_name",placeholder:"Product Name"},{type:"text",name:"product_price",placeholder:"Product Price"}],afterPost:function(){e.getProducts()}}))},h=r.a.createContext({});var v=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(null),i=Object(u.a)(o,2),s=i[0],m=i[1],d=Object(n.useState)(null),p=Object(u.a)(d,2),f=p[0],b=p[1],E=Object(n.useState)(""),v=Object(u.a)(E,2),y=v[0],g=v[1],k=function(){var e=document.cookie.split(";").reduce(function(e,t){var a=t.split("=");return 2===a.length&&(e[a[0].trim()]=a[1].trim()),e},{});return console.log(e),e},N={loggedIn:c,user_id:s,role:f,afterLogin:function(){l(!0),m(k().user_id),b(k().role),g(k().realname)},checkLogin:function(){k().user_id?l(!0):l(!1),k().user_id&&(b(k().role),m(k().user_id),g(k().realname))},logout:function(){l(!1),m(null),b(null),g(""),document.cookie="user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="role=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},realname:y};return r.a.createElement(h.Provider,{value:N},e.children)};var y=function(e){var t=Object(n.useContext)(h),a=Object(n.useContext)(m);return r.a.createElement("div",null,r.a.createElement(b,{apiPath:"/api/restaurants",inputs:[{type:"text",name:"restaurant_name",placeholder:"Restaurant Name"},{type:"text",name:"username",placeholder:"Username"},{type:"text",name:"realName",placeholder:"Name and surname"},{type:"password",name:"password",placeholder:"Password"}],afterPost:function(n){n.error||(t.afterLogin(),e.history.push("/restaurantlayout"),a.getRestaurantName())}}))},g=function(e){var t="/ticket/"+e.ticket_id;return r.a.createElement(o.b,{to:t,className:"ticket-links"},r.a.createElement("div",{className:"allTickets-ids"},e.ticket_id,r.a.createElement("div",{className:"calculateTime"},function(){var t=new Date(e.timestamp).getTime(),a=new Date-(t=new Date(t)),n=Math.floor(a%864e5%36e5/6e4*1),r=Math.floor(a%864e5%36e5%6e4/1e3*1);return"".concat(n,":").concat(r)}())))};var k=function(){var e=Object(n.useState)(0),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useContext)(m);return Object(n.useEffect)(function(){l.getTickets(),c(a+1),setInterval(function(){l.getTickets(),console.log("tickets!")},3e3)},[]),Object(n.useEffect)(function(){setTimeout(function(){c(a+1)},500)},[a]),r.a.createElement("div",{className:"ticket-parent"},l.tickets?l.tickets.results.map(function(e){var t=new Date(e.timestamp).getTime(),a=1e3*Math.round(t/1e3);return r.a.createElement(g,{ticket_id:e.ticket_id,timestamp:a})}):null)},N=function(e){var t=e.location.pathname.split("/"),a=t[t.length-1],c=Object(n.useState)(null),l=Object(u.a)(c,2),o=l[0],i=l[1];return Object(n.useEffect)(function(){d("/api/tickets/".concat(a),function(e,t){return i(t.results)})},[]),r.a.createElement("div",null,o?r.a.createElement("div",null,r.a.createElement("table",{className:"ticket-table"},r.a.createElement("tr",{className:"ticket-tr"},r.a.createElement("th",null,"Product"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Quantity")),r.a.createElement("tbody",null,o.map(function(e){return r.a.createElement("tr",null,r.a.createElement("td",null,e.product_name),r.a.createElement("td",null,"$ ",e.product_price),r.a.createElement("td",null,e.quantity))})),r.a.createElement("tfoot",null,r.a.createElement("tr",{className:"ticket-footer"},r.a.createElement("td",null),r.a.createElement("td",null,"Total: "),r.a.createElement("td",null,"$ ",Math.ceil(100*o.reduce(function(e,t){return e+=parseFloat(t.product_price)*parseInt(t.quantity)},0))/100)))),r.a.createElement("div",{className:"send-order-btn-holder"},r.a.createElement("input",{type:"button",value:"Checkout",className:"send-order-btn",onClick:function(t){t.preventDefault(),console.log(window.location.href),fetch(s+"/api/tickets/".concat(a),{method:"PUT",credentials:"include"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.history.push("/all-tickets")})}}))):r.a.createElement("p",null,"Loading..."))},O=a(60),j=function(e){return r.a.createElement("div",{className:"items-in-ticket"},r.a.createElement("input",{style:{display:"none"},className:"product_id",value:e.item.product_id}),r.a.createElement("p",null,e.product.product_name),r.a.createElement("p",null,"$ ",e.product.product_price),r.a.createElement("input",{required:!0,className:"quantity",type:"number",min:0,value:e.item.quantity}))};var _=function(e){var t=Object(n.useContext)(m);return r.a.createElement("div",{className:"orderForm-parent",id:"order-form-div"},r.a.createElement("form",{id:"order-form",onSubmit:function(a){a.preventDefault();var n=new URLSearchParams;n.append("table_id",document.querySelector("#table_id").value),console.log(n),fetch(s+"/api/tickets/",{method:"POST",credentials:"include",body:n}).then(function(e){return e.json()}).then(function(a){var n=a.ticket_id,r=new URLSearchParams,c=Array.from(document.querySelector("#productsInOrder").children).reduce(function(e,t){return e.push({product_id:t.querySelector(".product_id").value,quantity:t.querySelector(".quantity").value}),e},[]);r.append("products",JSON.stringify(c)),console.log("submitting form for ticket nr",n),fetch(s+"/api/tickets/".concat(n),{method:"POST",credentials:"include",body:r}).then(function(e){return e.json()}).then(function(a){t.setProductInTicket([]),e.history.push("/all-tickets")})})}},r.a.createElement("div",{className:"table-num-holder"},r.a.createElement("h3",{className:"table-number-title"},"Table Name"),r.a.createElement("p",{className:"table-name"},t.activeTable.table_name),r.a.createElement("input",{id:"table_id",type:"hidden",value:t.activeTable.table_id,name:"table_id"})),r.a.createElement("div",{className:"orderForm-items",id:"productsInOrder"},t.productsInTicket.map(function(e){var a=t.products.results.find(function(t){return t.product_id==e.product_id});return r.a.createElement(j,{product:a,item:e})})),r.a.createElement("div",{className:"send-order-btn-holder"},r.a.createElement("input",{type:"submit",value:"Send Order",className:"send-order-btn"}))))};var T=function(e){var t=Object(n.useContext)(m),a=Object(n.useState)(1),c=Object(u.a)(a,2),l=c[0],o=c[1];return Object(n.useEffect)(function(){t.getProducts(),o(l+1)},[]),r.a.createElement("div",null,r.a.createElement(f,{addProductOnClick:function(e){console.log(e.target);var a=t.productsInTicket.find(function(t){return t.product_id==e.target.className});a?a.quantity++:t.setProductInTicket([].concat(Object(O.a)(t.productsInTicket),[{product_id:e.target.className,quantity:1}])),o(l+1)},isOrderView:!0}),r.a.createElement(_,{history:e.history}))},x=a(153),C=a(141);var S=function(e){var t=Object(n.useContext)(m),a=t.tablesCoords.find(function(t){return t.table_id==e.table_id});return r.a.createElement(C.a,{onDragStop:function(a,n){var r=t.tablesCoords.map(function(t){return t.table_id==e.table_id&&(t.x=n.x,t.y=n.y),t});t.setTablesCoords(r)},default:{x:t.tablesCoords.find(function(t){return t.table_id==e.table_id}).x,y:t.tablesCoords.find(function(t){return t.table_id==e.table_id}).y,width:100,height:100},minWidth:100,minHeight:100,bounds:"parent",enableResizing:!1,dragGrid:[10,10],disableDragging:e.draggable},r.a.createElement("div",{onClick:e.createTicket,className:a.hasTicket?"box layout-bord bord-has-ticket":"box layout-bord"},a.table_name))};var P=function(e){var t=Object(n.useContext)(m),a=Object(n.useContext)(h),c=Object(n.useState)(!0),l=Object(u.a)(c,2),o=l[0],i=l[1],p=function(){d("/api/tickets",function(e,a){fetch(s+"/api/bord",{method:"GET",credentials:"include"}).then(function(e){return e.json()}).then(function(e){console.log(e),t.setTablesCoords(e.results.map(function(e){var t=a.results.find(function(t){return t.table_id==e.table_id});return Object(x.a)({},e,{hasTicket:!!t})}))})})};Object(n.useEffect)(function(){p(),setInterval(function(){p()},3e3)},[]);var f=function(a){if(o){var n=t.tablesCoords.find(function(e){return e.table_name==a.target.innerHTML});t.setActiveTable(n),e.history.push("/order")}};return r.a.createElement("div",{className:"layout-parent"},"admin"==a.role?o?r.a.createElement("div",{className:"btn-container"},r.a.createElement("button",{className:"layout-btn",onClick:function(e){i(!1)}},"Edit Layout")):r.a.createElement("div",{className:"btn-container"},r.a.createElement("button",{className:"layout-btn",onClick:function(e){var a=new URLSearchParams;a.append("table_name",JSON.stringify(t.nextTicketName)),fetch(s+"/api/bord",{method:"POST",credentials:"include",body:a}).then(function(e){return e.json()}).then(function(e){t.setTablesCoords([].concat(Object(O.a)(t.tablesCoords),[{table_id:e.table_id,x:e.x,y:e.y,table_name:t.nextTicketName}])),t.incrementNextTicketName()})}},"Add Table"),r.a.createElement("button",{className:"layout-btn",onClick:function(e){var a=new URLSearchParams;a.append("bords",JSON.stringify(t.tablesCoords)),fetch(s+"/api/bord",{method:"PUT",credentials:"include",body:a}).then(function(e){return e.json()}).then(function(e){i(!0)})}},"Save Layout")):r.a.createElement("div",null),r.a.createElement("div",{className:"layout-container",id:"layoutContainer"},t.tablesCoords.map(function(e){return r.a.createElement(S,{key:e.table_id,table_id:e.table_id,draggable:o,createTicket:f})})))};var w=function(e){var t=Object(n.useContext)(h),a=Object(n.useContext)(m);return r.a.createElement("div",null,r.a.createElement(b,{apiPath:"/api/login",inputs:[{type:"text",name:"username",placeholder:"Username"},{type:"password",name:"password",placeholder:"Password"}],afterPost:function(n){n.error||(t.afterLogin(),e.history.push("/restaurantlayout"),a.getRestaurantName())}}),r.a.createElement("button",null,r.a.createElement(o.b,{to:"/signup"},"Signup")))};var I=function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],c=t[1];return Object(n.useContext)(m),Object(n.useEffect)(function(){d("/api/users",function(e,t){e&&console.log(e),c(t.results)})},[]),r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(b,{apiPath:"/api/users",inputs:[{type:"text",name:"username",placeholder:"Username"},{type:"text",name:"realName",placeholder:"Fullname"},{type:"password",name:"password",placeholder:"Password"},{type:"select",name:"role",options:["admin","employee"]}],afterPost:function(e){d("/api/users",function(e,t){e&&console.log(e),c(t.results),console.log(t.results)})}})),a&&r.a.createElement("div",null,r.a.createElement("table",{className:"ticket-table"},r.a.createElement("tr",{className:"ticket-tr"},r.a.createElement("th",null,"Id"),r.a.createElement("th",null,"Username"),r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Role")),r.a.createElement("tbody",null,a.map(function(e){return r.a.createElement("tr",null,r.a.createElement("td",null,e.user_id),r.a.createElement("td",null,e.username),r.a.createElement("td",null,e.realname),r.a.createElement("td",null,e.role))})))))},L=a(16);var R=function(){Object(n.useContext)(m);var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],s=o[1];Object(n.useEffect)(function(){d("/api/tickets/stats",function(e,t){var a=t.results.reduce(function(e,t){var a=new Date(t.timestamp).toISOString().slice(0,10),n=e.find(function(e){return e.date===a}),r=parseFloat(t.product_price)*parseInt(t.quantity);return n?n.sum+=r:e.push({date:a,sum:r}),e},[]);a.sort(function(e,t){return e.date>t.date?1:-1}),c(a),a=t.results.reduce(function(e,t){console.log(t);var a=e.find(function(e){return e.id===t.user_id}),n=parseFloat(t.product_price)*parseInt(t.quantity);return a?a.sum+=n:e.push({name:t.realname,id:t.user_id,sum:n}),e},[]),console.log(a),s(a)})},[]);var p=["#0088FE","#58b368","#91A0CE","#FFBB28","#FF8042"],f=function(e){var t=e.cx,a=e.cy,n=e.midAngle,c=e.innerRadius,l=e.outerRadius,o=e.percent,i=(e.index,Math.PI/180),u=c+.5*(l-c),s=t+u*Math.cos(-n*i),m=a+u*Math.sin(-n*i);return r.a.createElement("text",{x:s,y:m,fill:"white",textAnchor:s>t?"start":"end",dominantBaseline:"central"},"".concat((100*o).toFixed(0),"%"))};return r.a.createElement("div",null,a&&r.a.createElement(L.d,{width:600,height:300,data:a,margin:{top:5,right:20,bottom:5,left:0}},r.a.createElement(L.c,{type:"monotone",dataKey:"sum",stroke:"#58b368",strokeWidth:"3",dot:{stroke:"#0088FE"}}),r.a.createElement(L.a,{stroke:"#ccc",strokeDasharray:"5 5"}),r.a.createElement(L.h,{dataKey:"date",stroke:"#91a0ce"}),r.a.createElement(L.i,{stroke:"#91a0ce"}),r.a.createElement(L.g,null)),i&&r.a.createElement(L.f,{width:400,height:400},r.a.createElement(L.e,{data:i,cx:200,cy:200,labelLine:!1,label:f,outerRadius:150,fill:"#8884d8",dataKey:"sum"},i.map(function(e,t){return r.a.createElement(L.b,{key:"cell-".concat(t),fill:p[t%p.length]})})),r.a.createElement(L.g,null)))};var q=function(){var e=Object(n.useContext)(h),t=Object(n.useContext)(m);return Object(n.useEffect)(function(){e.checkLogin(),console.log("app useeffect"),t.getRestaurantName()},[]),r.a.createElement("div",{className:"App"},r.a.createElement(o.a,{basename:"/POShGRIS"},r.a.createElement("div",{className:"nav-container"},e.loggedIn?"admin"==e.role?r.a.createElement("div",null,r.a.createElement("div",{className:"logo-container"},r.a.createElement("h3",{className:"username"},e.realname),r.a.createElement("h2",{className:"logo"},r.a.createElement(o.b,{to:"/"},t.restaurantName?t.restaurantName:"")),r.a.createElement("button",{className:"logout-btn",onClick:e.logout},"Logout")),r.a.createElement("ul",{className:"nav"},r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/products"},"Products")),r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/all-tickets"},"Tickets")),r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/restaurantlayout"},"Overview")),r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/employees"},"Employees")),r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/analytics"},"Analytics")))):r.a.createElement("div",null,r.a.createElement("div",{className:"logo-container"},r.a.createElement("h3",{className:"username"},e.realname),r.a.createElement("h2",{className:"logo"},r.a.createElement(o.b,{to:"/"},t.restaurantName?t.restaurantName:"")),r.a.createElement("button",{className:"logout-btn",onClick:e.logout},"Logout")),r.a.createElement("ul",{className:"nav"},r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/all-tickets"},"Tickets")),r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/restaurantlayout"},"Overview")))):r.a.createElement("ul",{className:"nav"},r.a.createElement("li",{className:"nav-links"},r.a.createElement(o.b,{to:"/login"},"Login")))),e.loggedIn?r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/employees",component:I}),r.a.createElement(i.a,{path:"/products",component:E}),r.a.createElement(i.a,{path:"/all-tickets",component:k}),r.a.createElement(i.a,{path:"/ticket/:id",component:N}),r.a.createElement(i.a,{path:"/order",component:T}),r.a.createElement(i.a,{path:"/restaurantlayout",component:P}),r.a.createElement(i.a,{path:"/analytics",component:R})):r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/login",component:w}),r.a.createElement(i.a,{path:"/signup",component:y}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(v,null,r.a.createElement(p,null,r.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[174,1,2]]]);
//# sourceMappingURL=main.1a594bc5.chunk.js.map